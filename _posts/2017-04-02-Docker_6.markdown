---
title: PM2를 사용하여 EC2에 Node 서버 배포하기
---

## Summary
---------------------
 node js 패키지 중에서 PM2를 사용하여 웹서버를 배포하자.

---------------------

## 순서
---------------------
1. Amazon web service에 Ubuntu OS를 사용하는 EC2 인스턴스 생성하기
1. 접속 포트를 열어주고 별도의 Ubuntu 유저를 생성하기
1. EC2에 Docker를 설치하고 Ubuntu 유저에게 권한주기
1. Bitbucket을 사용하여 git repository 생성하기
1. Express JS를 사용하여 Node 서버 구축하기
1. PM2를 사용하여 EC2에 Node 서버 배포하기
1. Node 서버를 바탕으로 Dockerfile로 만들기
1. Docker Hub의 automated build를 사용하여 Docker image를 만들기
1. 만들어진 Docker image를 EC2 인스턴스에 배포하기

---------------------

## 웹서버에 node js를 설치하고 PM2를 설치하기
---------------------

이전에 생성한 EC2 인스턴스에 ubuntu계정으로 SSH 접속한 후 Node js를 설치하자.

apt-get을 통해 설치하면 간단하게 node 서버 및 npm 패키지를 설치할 수 있다.

{% highlight shell %}
# node 7.x대 버전으로 받자.
$ curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
$ sudo apt-get install -y nodejs

# node-gyp 패키지와 같이 native addon을 컴파일하고 실행하려면 build-essential이 필요하다.
$ sudo apt-get install -y build-essential

# PM2를 전역적으로 사용하기 위해 -g 옵션을 붙여 설치하자.
$ sudo npm install -g pm2
{% endhighlight %}


---------------------


 docker 계정으로 File zilla를 사용하여 접속하자

/home/docker/ 디렉터리에 현재까지 작업한 node 서버를 node_modules를 제외하고 전송한다.

![file_zilla]({{ site.baseurl }}/images/aws/ec2/file_zilla.png)

---------------------

 docker 계정으로 SSH접속을 한 후에 pm2로 서버를 실행시키자. PM2에 대한 자세한 사용법은 [PM2 공식사이트](http://pm2.keymetrics.io/) 를 참고하면 된다.

{% highlight shell %}
# 천천히 명령어 한줄씩 실행하는 방법.
$ cd docker_node_server
$ npm install
$ pm2 start app.js

# 디렉터리 이동없이 실행.
$ npm install --prefix /home/docker/docker_node_server && pm2 start /home/docker/docker_node_server
{% endhighlight %}

![pm2]({{ site.baseurl }}/images/aws/ec2/pm2.png)

---------------------




## References
- [https://nodejs.org/ko/download/package-manager/](https://nodejs.org/ko/download/package-manager/)
- [http://pm2.keymetrics.io/](http://pm2.keymetrics.io/)


<!--- [https://www.docker.com/what-docker](https://www.docker.com/what-docker)
- [http://pyrasis.com/Docker/Docker-HOWTO](http://pyrasis.com/Docker/Docker-HOWTO)
- [https://www.slideshare.net/pyrasis/docker-docker-38286477](https://www.slideshare.net/pyrasis/docker-docker-38286477)
- [https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)
- [https://docs.docker.com/engine/installation/linux/ubuntu/](https://docs.docker.com/engine/installation/linux/ubuntu/)
- [https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04)-->

<!--
# Samples

# Heading 1

## Heading 2

### Heading 3

#### Heading 4

##### Heading 5

###### Heading 6

### Body text

**Lorem ipsum dolor sit amet**, consectetur adipiscing elit. Quisque tempus nunc diam, non dignissim risus tincidunt a. Curabitur consequat justo vitae ipsum accumsan tempor. Quisque rhoncus eleifend ante vitae ultricies. Pellentesque suscipit nisl ut metus tincidunt, vulputate sodales dui commodo. Sed eget sapien varius, lacinia lectus nec, tempor dolor. Pellentesque sed mattis magna. Curabitur ut tristique turpis. Morbi sagittis dolor suscipit urna placerat, consectetur venenatis sapien viverra. Mauris vitae felis et sem venenatis cursus.


![Image]({{ site.baseurl }}/images/test.png)


Donec ornare turpis non ullamcorper pulvinar. *Integer ut mauris vehicula mauris posuere adipiscing.* Phasellus dictum cursus convallis. Sed dapibus laoreet porttitor.

### Blockquotes

> Fusce non eleifend nisi. Donec pharetra sed ipsum sit amet sollicitudin. Duis dolor ante, gravida varius neque eget, semper commodo libero. In euismod tempor lobortis. Nulla eget lectus nec enim mattis aliquet a sit amet est.

## List Types

### Lists

1. Item One
   1. sub one
   2. sub two
   3. sub three
2. Item Two

* Uno
* Dos
* Tres


## Table

| Tables        | Are           | Cool  |
| ------------- |:-------------:| -----:|
| col 3 is      | right-aligned | $1600 |
| col 2 is      | centered      |   $12 |
| zebra stripes | are neat      |    $1 |


## Code

{% highlight python %}
class node:
    def __init__(self, data, next=None):
        self.data = data
        self.next = next
{% endhighlight %}-->
